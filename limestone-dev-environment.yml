# Limestone is a family of color themes for IDEs and text editors.
# https://github.com/jan-warchol/limestone-colors
#
# prerequisites:
# - git
# - credentials for accessing my repos over ssh configured

- name: Setup tools for work on Limestone project
  hosts: all
  vars:
    limestone_path: "{{ ansible_env.HOME }}/src/limestone-colors"
    code_samples_base_path: "{{ ansible_env.HOME }}/src/code-samples"

  tasks:

    ############################################# global settings

    - name: install IDEs for testing limestone
      snap:
        name:
          - pycharm-community
          - code
        classic: yes
      become: yes

    - name: ensure vscode config directories exist
      file:
        dest: "{{ ansible_env.HOME }}/{{ item }}"
        state: directory
      loop:
        - ".vscode/extensions"
        - ".config/Code/User"

    - name: configure vscode shortcuts
      copy:
        content: |
          // Place your key bindings in this file to override the defaults
          [
              {
                  "key": "ctrl+d",
                  "command": "editor.action.inspectTMScopes"
              }
          ]
        dest: "{{ ansible_env.HOME }}/.config/Code/User/keybindings.json"
        backup: yes  # in case I've made further modifications

    - name: link limestone theme to .extensions
      file:
        src: "{{ limestone_path }}/vscode"
        dest: "{{ ansible_env.HOME }}/.vscode/extensions/limestone-dev"
        state: link
        force: yes  # repo will be cloned in a later step

    # - name: install other vscode extensions

    ############################################# repository setup

    - name: clone limestone git repo
      git:
        repo: git@github.com:jan-warchol/limestone-colors.git
        dest: "{{ limestone_path }}"
        update: no  # don't mess with existing repo

    - name: clone code samples repo
      git:
        repo: git@github.com:jan-warchol/code-samples.git  # private
        dest: "{{ item }}"
        update: no  # don't mess with existing repo
      loop:
        - "{{ code_samples_base_path }}-A"
        - "{{ code_samples_base_path }}-B"

    - name: ensure .vscode dir exists
      file:
        dest: "{{ item }}/.vscode"
        state: directory
      loop:
        - "{{ code_samples_base_path }}-A"
        - "{{ code_samples_base_path }}-B"
        - "{{ limestone_path }}"

    - name: configure per-workspace vscode themes
      copy:
        # it doesn't really matter which theme I set initially - as long as
        # this is present, consecutive theme changes will be saved locally.
        content: |
          {
              "workbench.colorTheme": "Limestone 0.8"
          }
        dest: "{{ item }}/.vscode/settings.json"
      loop:
        - "{{ code_samples_base_path }}-A"
        - "{{ code_samples_base_path }}-B"
        - "{{ limestone_path }}"
